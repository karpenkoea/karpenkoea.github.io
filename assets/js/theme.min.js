/*
* HSCore
* @version: 4.0.0 (01 June, 2021)
* @author: HtmlStream
* @event-namespace: .HSCore
* @license: Htmlstream Libraries (https://htmlstream.com/licenses)
* Copyright 2021 Htmlstream
*/
"use strict";const HSCore={init:()=>{[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map((function(e){return new bootstrap.Tooltip(e)})),[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map((function(e){return new bootstrap.Popover(e)}))},components:{}};HSCore.init();const HSBsDropdown={init(e){this.setAnimations(),this.openOnHover()},setAnimations(){window.addEventListener("show.bs.dropdown",e=>{if(!e.target.hasAttribute("data-bs-dropdown-animation"))return;const t=e.target.nextElementSibling;t.style.opacity=0,setTimeout(()=>{t.style.transform=t.style.transform+" translateY(10px)"}),setTimeout(()=>{t.style.transform=t.style.transform+" translateY(-10px)",t.style.transition="transform 300ms, opacity 300ms",t.style.opacity=1},100)}),window.addEventListener("hide.bs.dropdown",e=>{if(!e.target.hasAttribute("data-bs-dropdown-animation"))return;const t=e.target.nextElementSibling;setTimeout(()=>{t.style.removeProperty("transform"),t.style.removeProperty("transition")})})},openOnHover(){Array.from(document.querySelectorAll("[data-bs-open-on-hover]")).forEach(e=>{var t;const s=new bootstrap.Dropdown(e);function n(){t=setTimeout(()=>{s.hide()},500)}e.addEventListener("mouseenter",()=>{clearTimeout(t),s.show()}),s._menu.addEventListener("mouseenter",()=>{window.clearTimeout(t)}),Array.from([s._menu,e]).forEach(e=>e.addEventListener("mouseleave",n))})}},validators={"data-hs-validation-equal-field":e=>{const t=document.querySelector(e.getAttribute("data-hs-validation-equal-field"));e.addEventListener("input",s=>{t.value.toString().toLocaleLowerCase()!==s.target.value.toString().toLocaleLowerCase()?e.setCustomValidity("qual-field"):e.setCustomValidity(""),HSBsValidation.updateFieldStete(e)}),t.addEventListener("input",t=>{e.value.toString().toLocaleLowerCase()!==t.target.value.toString().toLocaleLowerCase()?e.setCustomValidity("qual-field"):e.setCustomValidity(""),HSBsValidation.updateFieldStete(e)})}},HSBsValidation={init(e,t){var s=document.querySelectorAll(e);return Array.prototype.slice.call(s).forEach(e=>{for(const t in validators)Array.prototype.slice.call(e.querySelectorAll(`[${t}]`)).forEach(validators[t]);this.addVlidationListners(e.elements),e.addEventListener("submit",s=>{e.checkValidity()?this.onSubmit({event:s,form:e,options:t}):(s.preventDefault(),s.stopPropagation(),this.checkFieldsState(e.elements)),e.classList.add("was-validated")},!1)}),this},addVlidationListners(e){Array.prototype.slice.call(e).forEach(e=>{const t=e.closest("[data-hs-validation-validate-class]");t&&(e.addEventListener("input",e=>this.updateFieldStete(e.target)),e.addEventListener("focus",e=>t.classList.add("focus")),e.addEventListener("blur",e=>t.classList.remove("focus")))})},checkFieldsState(e){Array.prototype.slice.call(e).forEach(e=>this.updateFieldStete(e))},updateFieldStete(e){const t=e.closest("[data-hs-validation-validate-class]");t&&(e.checkValidity()?(t.classList.add("is-valid"),t.classList.remove("is-invalid")):(t.classList.add("is-invalid"),t.classList.remove("is-valid")))},onSubmit:e=>!(!e.options||"function"!=typeof e.options.onSubmit)&&e.options.onSubmit(e)};let activeIndex=0;var sliderThumbs=new Swiper(".js-swiper-thumbs",{slidesPerView:1,autoplay:!0,watchSlidesVisibility:!0,watchSlidesProgress:!0,disableOnInteraction:!0,followFinger:!1,loop:!0,on:{slideChangeTransitionEnd:function(e){void 0!==sliderMain&&sliderMain.slideTo(e.activeIndex)}}}),sliderMain=new Swiper(".js-swiper-main",{effect:"fade",autoplay:!1,disableOnInteraction:!0,loop:!0,navigation:{nextEl:".js-swiper-main-button-next",prevEl:".js-swiper-main-button-prev"},thumbs:{swiper:sliderThumbs},on:{slideChangeTransitionEnd:function(e){void 0!==sliderThumbs&&sliderThumbs.slideTo(e.activeIndex)}}});class ShuffleCatalog{constructor(e){this.element=e,this.shuffle=new Shuffle(e,{itemSelector:".js-shuffle-item",speed:500}),this.addFilterButtons()}addFilterButtons(){const e=document.querySelector(".js-filter-options");if(!e)return;const t=Array.from(e.children),s=this._handleFilterClick.bind(this);t.forEach(e=>{e.addEventListener("click",s,!1)})}_handleFilterClick(e){const t=e.currentTarget.firstElementChild,s=t.classList.contains("active"),n=t.getAttribute("data-group");let o;this._removeActiveClassFromChildren(t.parentNode.parentNode),s?(t.classList.remove("active"),o=Shuffle.ALL_ITEMS):(t.classList.add("active"),o=n),this.shuffle.filter(o)}_removeActiveClassFromChildren(e){const{children:t}=e;for(let e=t.length-1;e>=0;e--)t[e].firstElementChild.classList.remove("active")}updateShuffle(){this.shuffle=new Shuffle(this.element,{itemSelector:".js-shuffle-item",speed:500})}}const shuffleContainer=document.querySelector(".js-shuffle"),showMoreBtn=document.querySelector(".show-more");let shuffleInstance=new ShuffleCatalog(shuffleContainer);function getDeclension(e,t,s,n){return e=Math.abs(e),(e%=100)>=5&&e<=20?n:1===(e%=10)?t:e>=2&&e<=4?s:n}function initializeCountdown(e,t){document.querySelectorAll(t).forEach(t=>{const s=t.querySelector(".js-cd-days"),n=t.querySelector(".js-cd-hours"),o=t.querySelector(".js-cd-minutes");countdown(e,e=>{0!==e.days?s.innerHTML=`${e.days} <span class='fs-6'>${getDeclension(e.days,"день","дня","дней")}</span>`:s.innerHTML="",0!==e.hours?n.innerHTML=`${e.hours} <span class='fs-6'>${getDeclension(e.hours,"час","часа","часов")}</span>`:n.innerHTML="",0!==e.minutes?o.innerHTML=`${e.minutes} <span class='fs-6'>${getDeclension(e.minutes,"минута","минуты","минут")}</span>`:o.innerHTML=""},countdown.DAYS|countdown.HOURS|countdown.MINUTES)})}const currentYear=(new Date).getFullYear(),targetDatePromo1=new Date(currentYear,11,1),targetDatePromo2=new Date(currentYear,12,1);initializeCountdown(targetDatePromo1,".js-countdown.promo-1"),initializeCountdown(targetDatePromo2,".js-countdown.promo-2");let warehouseDoorsSlider=new Swiper(".products-swiper.swiper-container",{slidesPerView:2.1,spaceBetween:10,sensitivity:1e3,breakpoints:{640:{slidesPerView:3.4,spaceBetween:20},768:{slidesPerView:4,spaceBetween:16},1024:{slidesPerView:5,spaceBetween:16}},pagination:{el:".products-swiper-pagination.swiper-pagination",clickable:!0},navigation:{nextEl:".products-swiper-button-next",prevEl:".products-swiper-button-prev"}});const doorsSliderItems=document.querySelectorAll(".products-swiper .swiper-slide"),main=document.querySelector("main");async function loadProductData(e){try{const t=await fetch("./assets/json/products.json"),s=await t.json();return s.find(t=>t.id===e)}catch(e){console.error("Ошибка загрузки данных о товаре",e)}}const loadImageWithCheck=async e=>new Promise((t,s)=>{const n=new Image;n.onload=()=>t(e),n.onerror=()=>s("Image failed to load"),n.src=e});function scrollToSection(e){const t=document.getElementById(e);if(t){const e=-36,s=t.getBoundingClientRect().top+window.pageYOffset+e;window.scrollTo({top:s,behavior:"smooth"})}}doorsSliderItems.length>0&&doorsSliderItems.forEach((e,t)=>{e.querySelector(".card-body .card-title");e.querySelector(".card-footer button").addEventListener("click",async e=>{e.preventDefault(),e.stopPropagation();const s=document.querySelector(".modal-spinner");s.classList.remove("d-none");const n=t+1;let o;try{if(o=await loadProductData(n),!o)throw new Error("Данные о товаре не найдены");const{name:e,image:t,imageStart:i,imageSection:a,appointments:l,features:r,description:c,sizes:d,sizes_add:u,basics:m,specifications:p}=o,h=[];t&&""!==t.trim()&&h.push(t),i&&""!==i.trim()&&h.push(i),i&&""!==i.trim()&&h.push(a);const f=h.map(e=>loadImageWithCheck(e));await Promise.all(f),s.classList.add("d-none");const v=new bootstrap.Modal(document.getElementById("dynamicModal"));let g="";i&&""!==i.trim()&&(g=`<img class="img-fluid" src="${i}" alt="">`);const w=`\n            <div class="modal-header pb-3">\n               <h5 class="modal-title">${e}</h5>\n               <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n            </div>\n            <div class="modal-body pt-3">\n               <p class="text-dark fs-6">${c}</p>\n               <div class="row mb-5">\n                  <div class="col-12 col-lg-5">\n                     <img class="img-fluid" src="${t}" alt="">\n                  </div>\n                  <div class="col-12 col-lg-7 mx-lg-auto py-5 ps-lg-5">\n                     ${r?`<ul class="list-checked list-checked-md list-checked-bg-success">${r.map(e=>`<li class="list-checked-item">${e}</li>`).join("")}</ul>`:""}\n                     \n                  \n                     ${l?`\n                        <h6 class="text-primary mt-5">Назначение:</h6>\n                        <ul class="list-checked list-checked-primary fs-6">${l.map(e=>`<li class="list-checked-item text-primary">${e}</li>`).join("")}</ul>\n                        `:""}\n                     \n                  </div>\n               </div>\n               <div class="row mb-5">\n                  ${d?`<h6>Типоразмеры дверной коробки:</h6>\n                     <p class="fs-6 mb-0">${d}</p>`:""}\n\n                  ${u?`<p class="fs-6 mb-0 mt-2">${u}</p>`:""} \n               </div>\n               \n               <div class="row mb-5">\n                  <div class="col-12 col-lg-5">\n                     ${g}\n                  </div>\n                  <div class="col-12 col-lg-6 mx-lg-auto pt-5 pb-3 ps-lg-5 bg-light rounded-1">\n                     <h5 class="mb-3 fw-normal">В базовую комплектацию входят:</h5>\n                  \n                     ${m?`<ul class="list-checked list-checked-success fs-6">${m.map(e=>`<li class="list-checked-item">${e}</li>`).join("")}</ul>`:""}\n                  \n                  </div>\n               </div>\n               <div class="row">\n                  <div class="col-12 col-lg-5">\n                     <img class="img-fluid" src="${a}" alt="">\n                  </div>\n                  <div class="col-12 col-lg-6 mx-lg-auto pt-5 pb-3 ps-lg-5">\n                     <h5 class="mb-3 fw-normal">Технические характеристики:</h5>\n\n                     ${p?`<ul class="list-pointer list-pointer-sm list-pointer-primary fs-6">${p.map(e=>`<li class="list-pointer-item">${e}</li>`).join("")}</ul>`:""}\n                  </div>\n               </div>\n            </div>\n            <div class="modal-footer">\n               <button type="button" class="btn btn-white" data-bs-dismiss="modal">Закрыть</button>\n               <button id="spp" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#orderModal">Заказать замер</button>\n            </div>\n        `;document.querySelector("#dynamicModal .modal-content").innerHTML=w,v.show();document.querySelector("#spp").addEventListener("click",()=>{v.hide()})}catch(e){s.classList.add("d-none"),console.error("Ошибка загрузки данных о товаре",e);const t=document.createElement("div");t.classList.add("alert","alert-danger"),t.textContent="Ошибка загрузки данных о товаре",main.appendChild(t)}})});const scrollTargets=document.querySelectorAll("[data-scroll-target]");scrollTargets.forEach(e=>{e.addEventListener("click",(function(t){if(t.preventDefault(),t.target.classList.contains("btn")&&t.target.blur(),t.target.classList.contains("nav-link")){const e=t.target.closest(".navbar"),s=t.target.closest(".offcanvas");if(e){const s=e.querySelector(".navbar-toggler"),n=t.target.closest(".navbar").querySelector(".navbar-collapse");s&&n&&(s.classList.add("collapsed"),s.setAttribute("aria-expanded","false"),n.classList.remove("show"))}if(s){const e=s.querySelector(".btn-close");e&&e.click()}}const s=e.getAttribute("data-scroll-target");s&&scrollToSection(s)}))});